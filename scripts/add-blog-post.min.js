#!/usr/bin/env node
import fs from"fs";import path from"path";import{fileURLToPath}from"url";const __filename=fileURLToPath(import.meta.url),__dirname=path.dirname(__filename),rootDir=path.join(__dirname,"..");function slugify(text){return text.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}function extractTitleFromContent(content){const headingMatch=content.match(/^#\s+(.+)$/m);if(headingMatch)return headingMatch[1].trim();const lines=content.split("\n"),firstLine=lines[0]?.trim();return firstLine&&!firstLine.startsWith("#")?firstLine:"Untitled Post"}function extractExcerpt(content){let excerpt=(content.replace(/^---[\s\S]*?---\n/,"").split("\n").filter((line=>line.trim()&&!line.startsWith("#"))).map((line=>line.trim()))[0]||"").replace(/["']/g,"").replace(/_/g,"").replace(/\*/g,"").replace(/\\/g,"").trim();return excerpt.length>150&&(excerpt=excerpt.substring(0,147)+"..."),excerpt}function generateSlugFromFilename(filename){return slugify(path.basename(filename,".md"))}function createFrontmatter(title,excerpt,slug){return`---\ntitle: "${title}"\nexcerpt: "${excerpt}"\ncategory: "Design"\ndate: "${(new Date).toISOString().split("T")[0]}"\nreadTime: 8\nimage:\n  url: "https://storage.googleapis.com/48877118-7272-4a4d-b302-0465d8aa4548/82a39242-0101-4672-9473-4b58cfed4a4f/44ca43ce-5b00-40e9-b581-7547bb45b8ae.jpg"\n  alt: "${title}"\n---\n\n`}async function convertMarkdownToBlogPost(filename){const filePath=path.join(rootDir,filename);if(!fs.existsSync(filePath))return void console.error(`File not found: ${filename}`);console.log(`Converting ${filename} to blog post...`);const content=fs.readFileSync(filePath,"utf8"),title=extractTitleFromContent(content),excerpt=extractExcerpt(content),slug=generateSlugFromFilename(filename);console.log(`Title: ${title}`),console.log(`Slug: ${slug}`),console.log(`Excerpt: ${excerpt}`);const finalContent=createFrontmatter(title,excerpt,slug)+content,blogPostPath=path.join(rootDir,"src","posts",`${slug}.md`);fs.writeFileSync(blogPostPath,finalContent),console.log(`âœ… Blog post created: ${blogPostPath}`),fs.unlinkSync(filePath),console.log("âœ… Original file removed from root"),console.log("ðŸ”„ Regenerating posts.json...");const{execSync:execSync}=await import("child_process");return execSync("node scripts/generate-posts-json.cjs",{cwd:rootDir}),console.log("âœ… posts.json updated"),console.log(`\nðŸŽ‰ Blog post ready at: /blog/${slug}`),slug}async function main(){const filename=process.argv[2];if(filename)await convertMarkdownToBlogPost(filename);else{const files=fs.readdirSync(rootDir).filter((file=>file.endsWith(".md")&&!["README.md","README_React_snap.md"].includes(file)));0===files.length&&(console.log("No markdown files found in root directory."),process.exit(0)),console.log(`Found ${files.length} markdown file(s) to convert:`),files.forEach((file=>console.log(`  - ${file}`)));for(const file of files)await convertMarkdownToBlogPost(file)}}main().catch(console.error);