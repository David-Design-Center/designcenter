import fs from"fs";import path from"path";import{fileURLToPath}from"url";import grayMatter from"gray-matter";import{marked}from"marked";import*as cheerio from"cheerio";const __filename=fileURLToPath(import.meta.url),__dirname=path.dirname(__filename);marked.setOptions({breaks:!0,gfm:!0});const POSTS_DIR=path.resolve(__dirname,"../src/posts"),DIST_DIR=path.resolve(__dirname,"../dist");function getAllPosts(){return fs.readdirSync(POSTS_DIR).filter((file=>file.endsWith(".md"))).map((file=>{const slug=path.basename(file,".md"),filePath=path.join(POSTS_DIR,file),content=fs.readFileSync(filePath,"utf-8"),{data:frontmatter,content:markdownContent}=grayMatter(content);return{slug:slug,frontmatter:frontmatter,content:markdownContent,htmlContent:marked.parse(markdownContent)}}))}function processBlogPost(post){const{slug:slug,frontmatter:frontmatter,htmlContent:htmlContent}=post,blogHtmlPath=path.join(DIST_DIR,"blog",slug,"index.html");if(!fs.existsSync(blogHtmlPath))return console.log(`‚ùå HTML file not found for blog post: ${slug}`),!1;const originalHtml=fs.readFileSync(blogHtmlPath,"utf-8"),$=cheerio.load(originalHtml),errorMessage=$('div[style*="padding:4rem;text-align:center"] h2:contains("Oops, something went wrong")');if(errorMessage.length){console.log(`üîÑ Found error message in ${slug}, replacing with actual content`);let articleContainer=$("article");if(articleContainer.length)articleContainer.html(`\n        <div class="px-2 py-8 md:px-0">\n          <h1>${frontmatter.title}</h1>\n          <div id="blog-post-content">${htmlContent}</div>\n        </div>\n      `);else{const mainContent=$("#root").find("#smooth-content");errorMessage.parent().remove();const blogContentHtml=`\n        <div class="relative z-10 pt-[75vh] md:pt-[70vh]">\n          <div class="max-w-xl mx-auto px-2 md:px-20">\n            <article class="bg-white/90 backdrop-blur rounded-2xl shadow-md md:px-6 prose prose-[0.85rem] md:prose-sm max-w-xl mx-auto overflow-hidden mt-4 sm:px-4 mb-12">\n              <div class="px-2 py-8 md:px-0">\n                <h1>${frontmatter.title}</h1>\n                <div id="blog-post-content">${htmlContent}</div>\n              </div>\n            </article>\n          </div>\n        </div>\n      `;mainContent.find("footer").before(blogContentHtml)}return fs.writeFileSync(blogHtmlPath,$.html(),"utf-8"),console.log(`‚úÖ Successfully injected content for blog post: ${slug}`),!0}return console.log(`‚è≠Ô∏è No error message found in ${slug}, skipping...`),!1}async function main(){try{console.log("üîç Reading blog posts...");const posts=getAllPosts();console.log(`üìÑ Found ${posts.length} posts`);let success=0;for(const post of posts)processBlogPost(post)&&success++;return console.log(`‚úÖ Successfully processed ${success} out of ${posts.length} blog posts`),success}catch(error){console.error("‚ùå Error processing blog posts:",error),process.exit(1)}}main().catch((err=>{console.error("Fatal error:",err),process.exit(1)}));