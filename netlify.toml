[build]
  command = "npm run build"
  publish = "dist"

# Note: trailingSlash = "never" was removed because it caused redirect loops
# with SPA routes. Trailing slash removal is handled explicitly in _redirects.

[build.environment]
  NODE_VERSION = "22"
  NPM_FLAGS = "--legacy-peer-deps"

[[plugins]]
  package = "netlify-plugin-cache"
  [plugins.inputs]
    paths = [
      "node_modules/.cache",
      ".cache",
      "public",
      "dist"
    ]

[[plugins]]
  package = "@netlify/plugin-prerender"

  [plugins.inputs]
    # Enable prerendering for crawlers and AI agents
    enabled = true
    
    # Skip loading resources that don't affect returned HTML
    skipCSSFiles = true
    skipImageFiles = true
    skipVideoFiles = true
    skipFontFiles = true
    
    # Skip common tracking, analytics and marketing domains
    skipThirdPartyRequests = "googletagmanager.com, analytics.js"
    
    # Always skip these domains to speed up prerendering
    alwaysSkip = "tracker.com, analytics.js, googletagmanager.com, calendly.com, cookiebot.com, inspectlet.com"
    
    # Cache prerendered pages for 72 hours (6-720 hours, default: 72)
    cacheDuration = 72
    
    # Stale-while-revalidate duration in hours (0-168 hours, default: 24)
    staleWhileRevalidateDuration = 24